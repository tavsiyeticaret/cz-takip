<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CZ TAKƒ∞P</title>

  <style>
    *{box-sizing:border-box;margin:0;padding:0}

    :root{
      --radius-card:18px;
      --radius-pill:999px;
      --shadow:0 10px 30px rgba(15,23,42,.15);
    }

    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      padding:16px;
      transition:.2s;
    }

    body.light{
      --bg:#eef4ff;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#2563eb;
      --accent2:#1d4ed8;
      --soft:#e5edff;
      background:var(--bg);
      color:var(--text);
    }

    body.dark{
      --bg:#020617;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#8b5cf6;
      --accent2:#6366f1;
      --soft:#1e293b;
      background:radial-gradient(circle at top,#1e293b,#020617);
      color:var(--text);
    }

    .title{
      text-align:center;
      font-size:32px;
      font-weight:800;
      letter-spacing:.12em;
      margin-top:6px;
    }
    .subtitle{
      text-align:center;
      font-size:13px;
      color:var(--muted);
      margin-bottom:16px;
    }

    .top{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
    }

    .chip{
      border-radius:var(--radius-pill);
      padding:10px 14px;
      border:none;
      background:var(--soft);
      color:var(--accent);
      font-weight:700;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }

    .chip.primary{
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      color:#fff;
      box-shadow:0 10px 22px rgba(37,99,235,.22);
    }
    body.dark .chip.primary{
      box-shadow:0 10px 22px rgba(139,92,246,.20);
    }

    .card{
      background:var(--card);
      border-radius:var(--radius-card);
      padding:14px 16px;
      margin-bottom:12px;
      box-shadow:var(--shadow);
    }
    .card h3{
      font-size:18px;
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      margin-top:6px;
      gap:12px;
    }
    .label{color:var(--muted)}
    .value{font-weight:800}

    input{
      width:100%;
      padding:12px;
      border-radius:var(--radius-pill);
      border:1px solid #cbd5f5;
      font-size:18px;
      text-align:center;
      margin-top:6px;
      outline:none;
      background:#fff;
      color:#111827;
    }
    body.dark input{
      background:#0b1224;
      color:var(--text);
      border:1px solid rgba(148,163,184,.25);
    }

    .info{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      font-weight:800;
      display:none;
    }
    .ok{background:#e8ffe8;color:#16a34a}
    .bad{background:#ffe8e8;color:#dc2626}
    .neutral{background:#e8f0ff;color:#2563eb}

    .save{
      width:100%;
      margin-top:12px;
      padding:14px;
      border-radius:var(--radius-pill);
      border:none;
      font-size:18px;
      font-weight:800;
      background:linear-gradient(90deg,#2563eb,#1d4ed8);
      color:#fff;
      cursor:pointer;
    }
    body.dark .save{
      background:linear-gradient(90deg,#8b5cf6,#6366f1);
    }

    /* MODAL */
    .modal-backdrop{
      position:fixed;inset:0;
      background:rgba(2,6,23,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:18px;
      z-index:9999;
    }
    .modal{
      width:min(520px,100%);
      background:var(--card);
      color:var(--text);
      border-radius:22px;
      box-shadow:0 20px 60px rgba(0,0,0,.35);
      padding:16px;
    }
    .modal h4{
      font-size:18px;
      margin-bottom:8px;
      font-weight:900;
    }
    .modal p{
      color:var(--muted);
      font-size:13px;
      margin-bottom:12px;
      line-height:1.35;
    }
    .modal-actions{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .btn{
      flex:1;
      padding:12px 14px;
      border-radius:999px;
      border:none;
      font-weight:900;
      cursor:pointer;
    }
    .btn.secondary{
      background:var(--soft);
      color:var(--accent);
    }
    .btn.primary{
      background:linear-gradient(90deg,var(--accent),var(--accent2));
      color:#fff;
    }

    .small{
      font-size:12px;
      color:var(--muted);
      margin-top:10px;
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="title">CZ TAKƒ∞P</div>
  <div class="subtitle">20 g√ºnde 1 b√∂l√ºm ¬∑ 30 b√∂l√ºml√º CZ d√∂ng√ºs√º</div>

  <div class="top">
    <button id="themeBtn" class="chip">üåô Tema</button>
    <button id="setNowBtn" class="chip primary">‚ú® ≈ûu anki b√∂l√ºm</button>
  </div>

  <div class="card">
    <h3>üìÖ Tarih & S√ºre</h3>
    <div class="row"><span class="label">Bug√ºn:</span><span class="value" id="today"></span></div>
    <div class="row"><span class="label">Biti≈ü tarihi:</span><span class="value" id="end"></span></div>
    <div class="row"><span class="label">Kalan g√ºn:</span><span class="value" id="left"></span></div>
  </div>

  <div class="card">
    <h3>üìò B√∂l√ºm Bilgisi</h3>
    <div class="row"><span class="label">Olman gereken b√∂l√ºm:</span><span class="value" id="section"></span></div>
    <div class="row"><span class="label">Sayfa aralƒ±ƒüƒ±:</span><span class="value" id="range"></span></div>
  </div>

  <div class="card">
    <h3>üìñ Okuma Giri≈üi</h3>
    <input id="page" type="number" min="1" max="604" placeholder="Son okuduƒüun sayfa" />
    <div id="info" class="info neutral"></div>
    <button class="save" id="save">Kaydet</button>
  </div>

  <!-- MODAL -->
  <div id="modalWrap" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true">
      <h4>≈ûu anki b√∂l√ºm√ºn√º gir</h4>
      <p>Sistemi ilk kez kullanƒ±rken bir kere girmen yeterli. Sonradan istersen yine deƒüi≈ütirebilirsin.</p>
      <input id="nowInput" type="number" min="1" max="30" placeholder="1‚Äì30" />
      <div class="modal-actions">
        <button id="cancelModal" class="btn secondary">ƒ∞ptal</button>
        <button id="okModal" class="btn primary">Tamam</button>
      </div>
      <div class="small">√ñrnek: ‚Äú≈ûu an 8. b√∂l√ºmdeyim‚Äù ‚Üí 8 yaz</div>
    </div>
  </div>

  <script>
    const DAY = 86400000;

    /* Sƒ∞STEM REFERANSI (deƒüi≈ütirme) */
    const REF = Date.UTC(2022, 3, 12);   // 12.04.2022 (UTC)
    const TOTAL = 30;
    const PER = 20;
    const LAST = 604;

    const $ = (id) => document.getElementById(id);

    function todayUTC(){
      const d = new Date();
      return Date.UTC(d.getFullYear(), d.getMonth(), d.getDate());
    }

    function fmt(u){
      const d = new Date(u);
      const dd = String(d.getUTCDate()).padStart(2,"0");
      const mm = String(d.getUTCMonth()+1).padStart(2,"0");
      const yy = d.getUTCFullYear();
      return dd+"."+mm+"."+yy;
    }

    function mod(n,m){ return ((n % m) + m) % m; }

    function getShift(){
      return parseInt(localStorage.getItem("shift") || "0", 10);
    }

    function setShift(s){
      localStorage.setItem("shift", String(s));
    }

    function baseSectionForToday(){
      const now = todayUTC();
      let diff = Math.floor((now - REF) / DAY);
      if(diff < 0) diff = 0;
      const cycle = Math.floor(diff / 20);
      return (cycle % TOTAL) + 1;  // 1..30
    }

    function openModal(force){
      $("modalWrap").style.display = "flex";
      $("modalWrap").setAttribute("aria-hidden","false");
      $("nowInput").value = "";
      $("nowInput").focus();

      if(force){
        $("cancelModal").style.display = "none";
      }else{
        $("cancelModal").style.display = "";
      }
    }

    function closeModal(){
      $("modalWrap").style.display = "none";
      $("modalWrap").setAttribute("aria-hidden","true");
    }

    function applyNowSectionInput(v){
      const now = baseSectionForToday();     // sistemin bug√ºnk√º baz b√∂l√ºm√º
      const userNow = v;                     // kullanƒ±cƒ±nƒ±n bug√ºn ‚Äú≈üu anki b√∂l√ºm√º‚Äù
      const shift = mod((userNow - now), TOTAL); // kaydƒ±rma
      setShift(shift);
      closeModal();
      render();
    }

    function render(){
      const last = parseInt(localStorage.getItem("last") || "0", 10);
      const now = todayUTC();

      let diff = Math.floor((now - REF) / DAY);
      if(diff < 0) diff = 0;

      const cycle = Math.floor(diff / 20);
      const cycleEnd = REF + cycle * 20 * DAY + 19 * DAY;

      $("today").textContent = fmt(now);
      $("end").textContent = fmt(cycleEnd);

      /* Kalan g√ºn: BUG√úN√ú SAYMA (04‚Üí20 = 16) */
      const leftDays = Math.max(0, Math.floor((cycleEnd - now) / DAY));
      $("left").textContent = leftDays + " g√ºn";

      const base = (cycle % TOTAL) + 1;     // 1..30
      const section = mod((base - 1) + getShift(), TOTAL) + 1;

      const dayIn = diff % 20;              // 0..19
      let reqPage = (section - 1) * PER + dayIn + 1;
      if(reqPage > LAST) reqPage = LAST;

      $("section").textContent = section;
      $("range").textContent = (section === 30)
        ? "581 ‚Äì 604"
        : ((section - 1) * 20 + 1) + " ‚Äì " + ((section - 1) * 20 + 20);

      const info = $("info");
      if(last){
        const diffp = last - reqPage;
        info.style.display = "block";
        if(diffp > 0){ info.className="info ok"; info.textContent = diffp + " sayfa ileridesin"; }
        else if(diffp < 0){ info.className="info bad"; info.textContent = Math.abs(diffp) + " sayfa geridesin"; }
        else{ info.className="info neutral"; info.textContent = "Tam yerindesin"; }
      }else{
        info.style.display = "none";
      }

      $("page").value = last || "";
    }

    $("save").onclick = () => {
      const v = parseInt($("page").value || "0", 10);
      if(v > 0 && v <= LAST) localStorage.setItem("last", String(v));
      render();
    };

    $("themeBtn").onclick = () => {
      const d = document.body.classList.toggle("dark");
      document.body.classList.toggle("light", !d);
      localStorage.setItem("theme", d ? "dark" : "light");
    };

    $("setNowBtn").onclick = () => {
      openModal(false);
    };

    $("cancelModal").onclick = () => {
      closeModal();
    };

    $("okModal").onclick = () => {
      const v = parseInt($("nowInput").value || "0", 10);
      if(v >= 1 && v <= 30) applyNowSectionInput(v);
    };

    $("nowInput").addEventListener("keydown", (e) => {
      if(e.key === "Enter"){
        const v = parseInt($("nowInput").value || "0", 10);
        if(v >= 1 && v <= 30) applyNowSectionInput(v);
      }
    });

    (function init(){
      const t = localStorage.getItem("theme") || "light";
      document.body.classList.add(t);

      render();

      /* ZORUNLU A√áILI≈û: daha √∂nce ayarlanmadƒ±ysa */
      const hasShift = localStorage.getItem("shift");
      if(hasShift === null){
        openModal(true);
      }
    })();
  </script>
</body>
</html>
