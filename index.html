<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CZ TAKƒ∞P</title>

  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{
      --radius-card:18px;
      --radius-pill:999px;
      --shadow:0 10px 30px rgba(15,23,42,.15);
      --focus:0 0 0 3px rgba(37,99,235,.25);
    }

    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      padding:16px;
      transition:.2s;
      min-height:100vh;
    }

    body.light{
      --bg:#eef4ff;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#2563eb;
      --soft:#e5edff;
      background:var(--bg);
      color:var(--text);
    }

    body.dark{
      --bg:#020617;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#8b5cf6;
      --soft:#1e293b;
      background:radial-gradient(circle at top,#1e293b,#020617);
      color:var(--text);
    }

    .title{
      text-align:center;
      font-size:32px;
      font-weight:800;
      letter-spacing:.12em;
      margin-top:6px;
    }
    .subtitle{
      text-align:center;
      font-size:13px;
      color:var(--muted);
      margin:10px 0 16px;
    }

    .top{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-bottom:14px;
    }
    .chip{
      flex:1;
      border-radius:var(--radius-pill);
      padding:10px 14px;
      border:none;
      background:var(--soft);
      color:var(--accent);
      font-weight:700;
      cursor:pointer;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius-card);
      padding:14px 16px;
      margin-bottom:12px;
      box-shadow:var(--shadow);
    }
    .card h3{
      font-size:18px;
      margin-bottom:10px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      gap:10px;
      margin-top:6px;
      align-items:center;
    }
    .label{color:var(--muted)}
    .value{font-weight:800}

    input{
      width:100%;
      padding:12px;
      border-radius:var(--radius-pill);
      border:1px solid #cbd5f5;
      font-size:18px;
      text-align:center;
      margin-top:8px;
      outline:none;
    }
    input:focus{box-shadow:var(--focus);border-color:#93c5fd}

    .info{
      margin-top:10px;
      padding:10px 12px;
      border-radius:14px;
      font-weight:800;
      display:none;
    }
    .ok{background:#e8ffe8;color:#16a34a}
    .bad{background:#ffe8e8;color:#dc2626}
    .neutral{background:#e8f0ff;color:#2563eb}

    .save{
      width:100%;
      margin-top:12px;
      padding:14px;
      border-radius:var(--radius-pill);
      border:none;
      font-size:18px;
      font-weight:900;
      background:linear-gradient(90deg,#2563eb,#1d4ed8);
      color:#fff;
      cursor:pointer;
    }

    /* ZORUNLU MODAL */
    .overlay{
      position:fixed;
      inset:0;
      background:rgba(2,6,23,.55);
      display:none;
      align-items:center;
      justify-content:center;
      padding:16px;
      z-index:9999;
    }
    .modal{
      width:min(520px,100%);
      background:var(--card);
      color:var(--text);
      border-radius:22px;
      box-shadow:0 20px 60px rgba(0,0,0,.35);
      padding:16px;
    }
    .modal h4{
      font-size:18px;
      margin-bottom:8px;
    }
    .modal p{
      font-size:13px;
      color:var(--muted);
      line-height:1.4;
      margin-bottom:10px;
    }
    .modal .note{
      background:var(--soft);
      border-radius:14px;
      padding:10px 12px;
      margin:10px 0 12px;
      color:var(--text);
      font-size:13px;
      line-height:1.35;
    }
    .modal .actions{
      display:flex;
      gap:10px;
      margin-top:12px;
    }
    .modal .actions button{
      flex:1;
      border:none;
      border-radius:var(--radius-pill);
      padding:12px 14px;
      font-weight:900;
      cursor:pointer;
    }
    .btn-primary{
      background:var(--accent);
      color:#fff;
    }
    .hint{
      margin-top:8px;
      font-size:12px;
      color:var(--muted);
      text-align:center;
      display:none;
    }
  </style>
</head>

<body>
  <div class="title">CZ TAKƒ∞P</div>
  <div class="subtitle">20 g√ºnde 1 b√∂l√ºm ¬∑ 30 b√∂l√ºml√º CZ d√∂ng√ºs√º</div>

  <div class="top">
    <button id="themeBtn" class="chip">üåô Tema</button>
    <button id="nowBtn" class="chip">‚öôÔ∏è ≈ûu anki b√∂l√ºm</button>
  </div>

  <div class="card">
    <h3>üìÖ Tarih & S√ºre</h3>
    <div class="row"><span class="label">Bug√ºn:</span><span class="value" id="today"></span></div>
    <div class="row"><span class="label">Biti≈ü tarihi:</span><span class="value" id="end"></span></div>
    <div class="row"><span class="label">Kalan g√ºn:</span><span class="value" id="left"></span></div>
  </div>

  <div class="card">
    <h3>üìò B√∂l√ºm Bilgisi</h3>
    <div class="row"><span class="label">Olman gereken b√∂l√ºm:</span><span class="value" id="section"></span></div>
    <div class="row"><span class="label">Sayfa aralƒ±ƒüƒ±:</span><span class="value" id="range"></span></div>
  </div>

  <div class="card">
    <h3>üìñ Okuma Giri≈üi</h3>
    <input id="page" type="number" min="1" max="604" placeholder="Son okuduƒüun sayfa">
    <div id="info" class="info neutral"></div>
    <button class="save" id="save">Kaydet</button>
  </div>

  <!-- ZORUNLU MODAL -->
  <div id="overlay" class="overlay">
    <div class="modal">
      <h4>≈ûu an hangi b√∂l√ºmdesin? (1‚Äì30)</h4>
      <p>Bu bilgi ilk kurulum i√ßin zorunlu. Daha sonra saƒü √ºstten tekrar deƒüi≈ütirilebilir: ‚Äú‚öôÔ∏è ≈ûu anki b√∂l√ºm‚Äù.</p>

      <div class="note">
        Not: Sisteme ge√ßerken ilk ba≈üladƒ±ƒüƒ±n b√∂l√ºm√º hatƒ±rlamƒ±yorsan, ≈üu anki b√∂l√ºm√ºn√ºn <b>7 eksiƒüini</b> ba≈ülangƒ±√ß kabul ediyoruz.<br>
        √ñrnek 1: ≈ûu an 8. b√∂l√ºm ‚Üí Ba≈ülangƒ±√ß 1<br>
        √ñrnek 2: ≈ûu an 5. b√∂l√ºm ‚Üí Ba≈ülangƒ±√ß 29
      </div>

      <input id="nowSectionInput" type="number" min="1" max="30" placeholder="√ñrn: 8">
      <div id="modalHint" class="hint">L√ºtfen 1 ile 30 arasƒ±nda bir sayƒ± gir.</div>

      <div class="actions">
        <button id="modalSave" class="btn-primary">Kaydet</button>
      </div>
    </div>
  </div>

  <script>
    const DAY = 86400000;

    /* D√∂ng√º referansƒ±: 01.01.2026 => 20 g√ºnl√ºk periyotlarƒ±n sonu 20.01.2026, 09.02.2026 ... */
    const REF = Date.UTC(2026, 0, 1);

    const TOTAL_SECTIONS = 30;
    const PAGES_PER_SECTION = 20;
    const LAST_PAGE = 604;
    const OFFSET_FOR_START = 7; // ≈üu anki b√∂l√ºm√ºn 7 eksiƒüi ba≈ülangƒ±√ß kabul√º

    const $ = (id) => document.getElementById(id);

    function todayUTC(){
      const d = new Date();
      return Date.UTC(d.getFullYear(), d.getMonth(), d.getDate());
    }

    function fmt(u){
      const d = new Date(u);
      const dd = String(d.getUTCDate()).padStart(2,"0");
      const mm = String(d.getUTCMonth()+1).padStart(2,"0");
      const yy = d.getUTCFullYear();
      return dd+"."+mm+"."+yy;
    }

    function wrapSection(n){
      let x = ((n - 1) % TOTAL_SECTIONS);
      if(x < 0) x += TOTAL_SECTIONS;
      return x + 1;
    }

    function getStartSectionFromNow(nowSection){
      return wrapSection(nowSection - OFFSET_FOR_START);
    }

    function ensureNowSection(){
      const saved = parseInt(localStorage.getItem("nowSection") || "0", 10);
      if(saved >= 1 && saved <= 30) return saved;
      return 0;
    }

    function openModal(force){
      $("overlay").style.display = "flex";
      $("modalHint").style.display = "none";
      const current = ensureNowSection();
      $("nowSectionInput").value = current ? String(current) : "";
      if(force){
        // zorunlu: arkaplana dokunarak kapatmayƒ± engelliyoruz (zaten kapatma butonu yok)
      }
      $("nowSectionInput").focus();
    }

    function closeModal(){
      $("overlay").style.display = "none";
    }

    function saveNowSectionFromModal(){
      const v = parseInt($("nowSectionInput").value || "0", 10);
      if(!(v >= 1 && v <= 30)){
        $("modalHint").style.display = "block";
        return;
      }
      localStorage.setItem("nowSection", String(v));
      closeModal();
      render();
    }

    function render(){
      const now = todayUTC();
      let diffDays = Math.floor((now - REF) / DAY);
      if(diffDays < 0) diffDays = 0;

      const cycle = Math.floor(diffDays / 20);
      const dayInCycle = diffDays % 20;

      const cycleStart = REF + cycle * 20 * DAY;
      const cycleEnd = cycleStart + 19 * DAY;

      $("today").textContent = fmt(now);
      $("end").textContent = fmt(cycleEnd);

      /* Kullanƒ±cƒ± istediƒüi gibi: bug√ºn√º sayma => 04->20 arasƒ± 16 */
      const left = Math.max(0, Math.floor((cycleEnd - now) / DAY));
      $("left").textContent = left + " g√ºn";

      const nowSection = ensureNowSection();
      if(!nowSection){
        openModal(true);
        return;
      }

      const startSection = getStartSectionFromNow(nowSection);
      const sectionToday = wrapSection(startSection + cycle);

      $("section").textContent = String(sectionToday);

      const startPage = (sectionToday - 1) * PAGES_PER_SECTION + 1;
      const endPage = Math.min(sectionToday * PAGES_PER_SECTION, LAST_PAGE);
      $("range").textContent = startPage + " ‚Äì " + endPage;

      let requiredPage = startPage + dayInCycle;
      if(requiredPage > LAST_PAGE) requiredPage = LAST_PAGE;

      const lastPage = parseInt(localStorage.getItem("lastPage") || "0", 10);
      const info = $("info");

      if(lastPage >= 1 && lastPage <= LAST_PAGE){
        const dp = lastPage - requiredPage;
        info.style.display = "block";
        if(dp > 0){
          info.className = "info ok";
          info.textContent = dp + " sayfa ileridesin";
        }else if(dp < 0){
          info.className = "info bad";
          info.textContent = Math.abs(dp) + " sayfa geridesin";
        }else{
          info.className = "info neutral";
          info.textContent = "Tam yerindesin";
        }
      }else{
        info.style.display = "none";
      }

      $("page").value = (lastPage >= 1 ? String(lastPage) : "");
    }

    $("save").onclick = () => {
      const v = parseInt($("page").value || "0", 10);
      if(v >= 1 && v <= LAST_PAGE){
        localStorage.setItem("lastPage", String(v));
      }
      render();
    };

    $("themeBtn").onclick = () => {
      const isDark = document.body.classList.toggle("dark");
      document.body.classList.toggle("light", !isDark);
      localStorage.setItem("theme", isDark ? "dark" : "light");
    };

    $("nowBtn").onclick = () => {
      openModal(false);
    };

    $("modalSave").onclick = () => {
      saveNowSectionFromModal();
    };

    (function init(){
      const t = localStorage.getItem("theme") || "light";
      document.body.classList.add(t);

      const nowSection = ensureNowSection();
      if(!nowSection){
        openModal(true);
      }else{
        render();
      }
    })();
  </script>
</body>
</html>
