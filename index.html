<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<title>CZ TAKÄ°P v50</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box;margin:0;padding:0}

:root{
  --radius-card:18px;
  --radius-pill:999px;
  --shadow:0 10px 30px rgba(15,23,42,.15);
}

body{
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
  padding:16px;
  transition:.2s;
}

/* AÃ‡IK TEMA */
body.light{
  --bg:#eef4ff;
  --card:#fff;
  --text:#111827;
  --muted:#6b7280;
  --accent:#2563eb;
  --soft:#e5edff;
  background:var(--bg);
  color:var(--text);
}

/* KOYU TEMA */
body.dark{
  --bg:#020617;
  --card:#0f172a;
  --text:#e5e7eb;
  --muted:#9ca3af;
  --accent:#8b5cf6;
  --soft:#1e293b;
  background:radial-gradient(circle at top,#1e293b,#020617);
  color:var(--text);
}

.title{
  text-align:center;
  font-size:32px;
  font-weight:800;
  letter-spacing:.12em;
}

.subtitle{
  text-align:center;
  font-size:13px;
  color:var(--muted);
  margin-bottom:16px;
}

.top{
  display:flex;
  justify-content:space-between;
  gap:8px;
  margin-bottom:14px;
}

.chip{
  border-radius:var(--radius-pill);
  padding:8px 14px;
  border:none;
  background:var(--soft);
  color:var(--accent);
  font-weight:600;
  cursor:pointer;
}

.card{
  background:var(--card);
  border-radius:var(--radius-card);
  padding:14px 16px;
  margin-bottom:12px;
  box-shadow:var(--shadow);
}

.card h3{
  font-size:18px;
  margin-bottom:8px;
}

.row{
  display:flex;
  justify-content:space-between;
  margin-top:4px;
}

.label{color:var(--muted)}

input{
  width:100%;
  padding:12px;
  border-radius:var(--radius-pill);
  border:1px solid #cbd5f5;
  font-size:18px;
  text-align:center;
  margin-top:6px;
}

.info{
  margin-top:8px;
  padding:8px 10px;
  border-radius:12px;
  font-weight:600;
  display:none;
}

.ok{background:#e8ffe8;color:#16a34a}
.bad{background:#ffe8e8;color:#dc2626}
.neutral{background:#e8f0ff;color:#2563eb}

.save{
  width:100%;
  margin-top:12px;
  padding:14px;
  border-radius:var(--radius-pill);
  border:none;
  font-size:18px;
  font-weight:700;
  background:linear-gradient(90deg,#2563eb,#1d4ed8);
  color:#fff;
}

/* ZORUNLU MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(2,6,23,.72);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
  padding:16px;
}
.modalBox{
  width:100%;
  max-width:420px;
  background:var(--card);
  color:var(--text);
  border-radius:18px;
  padding:16px;
  box-shadow:var(--shadow);
}
.modalTitle{
  font-size:18px;
  font-weight:800;
  margin-bottom:8px;
}
.modalNote{
  font-size:13px;
  color:var(--muted);
  line-height:1.35;
  margin-bottom:10px;
}
.modalBtn{
  width:100%;
  margin-top:10px;
  padding:14px;
  border-radius:var(--radius-pill);
  border:none;
  font-size:18px;
  font-weight:800;
  background:linear-gradient(90deg,#2563eb,#1d4ed8);
  color:#fff;
}
.smallHint{
  font-size:12px;
  color:var(--muted);
  margin-top:8px;
  text-align:center;
}
</style>
</head>

<body>
<div class="title">CZ TAKÄ°P</div>
<div class="subtitle">20 gÃ¼nde 1 bÃ¶lÃ¼m Â· 30 bÃ¶lÃ¼mlÃ¼ CZ dÃ¶ngÃ¼sÃ¼</div>

<div class="top">
  <button id="themeBtn" class="chip">ðŸŒ™ Tema</button>
  <button id="startBtn" class="chip">âš™ Åžu anki bÃ¶lÃ¼m</button>
</div>

<div class="card">
  <h3>ðŸ“… Tarih & SÃ¼re</h3>
  <div class="row"><span class="label">BugÃ¼n:</span><strong id="today"></strong></div>
  <div class="row"><span class="label">BitiÅŸ tarihi:</span><strong id="end"></strong></div>
  <div class="row"><span class="label">Kalan gÃ¼n:</span><strong id="left"></strong></div>
</div>

<div class="card">
  <h3>ðŸ“˜ BÃ¶lÃ¼m Bilgisi</h3>
  <div class="row"><span class="label">Olman gereken bÃ¶lÃ¼m:</span><strong id="section"></strong></div>
  <div class="row"><span class="label">Sayfa aralÄ±ÄŸÄ±:</span><strong id="range"></strong></div>
</div>

<div class="card">
  <h3>ðŸ“– Okuma GiriÅŸi</h3>
  <input id="page" type="number" min="1" max="604" placeholder="Son okuduÄŸun sayfa">
  <div id="info" class="info neutral"></div>
  <button class="save" id="save">Kaydet</button>
</div>

<div class="modal" id="nowModal" aria-hidden="true">
  <div class="modalBox" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <div class="modalTitle" id="mTitle">Åžu an okuduÄŸun bÃ¶lÃ¼m (zorunlu)</div>
    <div class="modalNote">
      Bu sisteme yeni geÃ§iyoruz. 3 yÄ±l Ã¶nce hangi bÃ¶lÃ¼mden baÅŸladÄ±ÄŸÄ±nÄ± hatÄ±rlaman gerekmiyor.
      <b>Sadece ÅŸu an okuduÄŸun bÃ¶lÃ¼m numarasÄ±nÄ± (1â€“30)</b> gir. Sistem seni otomatik hizalar.
    </div>
    <input id="nowInput" type="number" min="1" max="30" placeholder="Åžu an okuduÄŸun bÃ¶lÃ¼m: 1â€“30">
    <button class="modalBtn" id="nowSaveBtn">Kaydet</button>
    <div class="smallHint">Not: YanlÄ±ÅŸ girersen saÄŸ Ã¼stten istediÄŸin zaman deÄŸiÅŸtirebilirsin.</div>
  </div>
</div>

<script>
const DAY=86400000;
const REF=Date.UTC(2022,3,12);
const TOTAL=30;
const PER=20;
const LAST=604;

const $=id=>document.getElementById(id);

function todayUTC(){
  const d=new Date();
  return Date.UTC(d.getFullYear(),d.getMonth(),d.getDate());
}

function fmt(u){
  const d=new Date(u);
  return String(d.getUTCDate()).padStart(2,"0")+"."+String(d.getUTCMonth()+1).padStart(2,"0")+"."+d.getUTCFullYear();
}

function openNowModal(preset){
  const m=$("nowModal");
  if(typeof preset==="number" && preset>=1 && preset<=30) $("nowInput").value=String(preset);
  m.style.display="flex";
  m.setAttribute("aria-hidden","false");
  document.body.style.overflow="hidden";
  setTimeout(()=>{$("nowInput").focus();},50);
}

function closeNowModal(){
  const m=$("nowModal");
  m.style.display="none";
  m.setAttribute("aria-hidden","true");
  document.body.style.overflow="";
}

function getCycle(nowUTC){
  let diff=Math.floor((nowUTC-REF)/DAY);
  if(diff<0) diff=0;
  return Math.floor(diff/20);
}

function normalizeSection(n){
  let x=n%TOTAL;
  if(x<0) x+=TOTAL;
  return x;
}

/* KullanÄ±cÄ± "ÅŸu an okuduÄŸu bÃ¶lÃ¼mÃ¼" girer -> start (ofset) otomatik hesaplanÄ±r */
function setNowSection(nowSection){
  const now=todayUTC();
  const cycle=getCycle(now);
  const start = normalizeSection((nowSection-1) - cycle) + 1;
  localStorage.setItem("start", String(start));
  localStorage.setItem("nowSection", String(nowSection));
}

function getStart(){
  return parseInt(localStorage.getItem("start")||"0");
}

function getNowSection(){
  return parseInt(localStorage.getItem("nowSection")||"0");
}

function saveNowFromModal(){
  let v=parseInt(($("nowInput").value||"0").trim());
  if(v>=1 && v<=30){
    setNowSection(v);
    closeNowModal();
    render();
  }else{
    $("nowInput").value="";
    $("nowInput").focus();
  }
}

function render(){
  const start=getStart();
  if(!start){
    openNowModal(getNowSection()||0);
    return;
  }

  const last=parseInt(localStorage.getItem("last")||"0");
  const now=todayUTC();
  let diff=Math.floor((now-REF)/DAY);
  if(diff<0)diff=0;

  const cycle=Math.floor(diff/20);
  const cycleEnd=REF+cycle*20*DAY+19*DAY;

  $("today").textContent=fmt(now);
  $("end").textContent=fmt(cycleEnd);

  /* BUGÃœN HARÄ°Ã‡: +1 yok */
  $("left").textContent=Math.max(0, Math.floor((cycleEnd - now) / DAY))+" gÃ¼n";

  const reqSection=((start-1+cycle)%TOTAL)+1;
  const dayIn=diff%20;
  let reqPage=(reqSection-1)*PER+dayIn+1;
  if(reqPage>LAST)reqPage=LAST;

  $("section").textContent=reqSection;
  $("range").textContent=reqSection===30?"581 â€“ 604":((reqSection-1)*20+1)+" â€“ "+((reqSection-1)*20+20);

  const info=$("info");
  if(last){
    const diffp=last-reqPage;
    info.style.display="block";
    if(diffp>0){info.className="info ok";info.textContent=diffp+" sayfa ileridesin";}
    else if(diffp<0){info.className="info bad";info.textContent=Math.abs(diffp)+" sayfa geridesin";}
    else{info.className="info neutral";info.textContent="Tam yerindesin";}
  }else{
    info.style.display="none";
  }

  $("page").value=last||"";
}

$("save").onclick=()=>{
  let v=parseInt($("page").value||"0");
  if(v>LAST)v=LAST;
  if(v>0)localStorage.setItem("last",String(v));
  render();
};

$("startBtn").onclick=()=>{
  openNowModal(getNowSection()||0);
};

$("nowSaveBtn").onclick=saveNowFromModal;

$("nowInput").addEventListener("keydown",(e)=>{
  if(e.key==="Enter") saveNowFromModal();
});

$("themeBtn").onclick=()=>{
  const d=document.body.classList.toggle("dark");
  document.body.classList.toggle("light",!d);
  localStorage.setItem("theme",d?"dark":"light");
};

document.addEventListener("DOMContentLoaded",()=>{
  const t=localStorage.getItem("theme")||"light";
  document.body.classList.add(t);

  /* ZORUNLU: start yoksa anÄ±nda modal aÃ§ */
  if(!getStart()){
    openNowModal(getNowSection()||0);
  }

  render();
});
</script>
</body>
</html>  background:var(--card);
  border-radius:var(--radius-card);
  padding:14px 16px;
  margin-bottom:12px;
  box-shadow:var(--shadow);
}

.card h3{
  font-size:18px;
  margin-bottom:8px;
}

.row{
  display:flex;
  justify-content:space-between;
  margin-top:4px;
}

.label{color:var(--muted)}

input{
  width:100%;
  padding:12px;
  border-radius:var(--radius-pill);
  border:1px solid #cbd5f5;
  font-size:18px;
  text-align:center;
  margin-top:6px;
}

.info{
  margin-top:8px;
  padding:8px 10px;
  border-radius:12px;
  font-weight:600;
  display:none;
}

.ok{background:#e8ffe8;color:#16a34a}
.bad{background:#ffe8e8;color:#dc2626}
.neutral{background:#e8f0ff;color:#2563eb}

.save{
  width:100%;
  margin-top:12px;
  padding:14px;
  border-radius:var(--radius-pill);
  border:none;
  font-size:18px;
  font-weight:700;
  background:linear-gradient(90deg,#2563eb,#1d4ed8);
  color:#fff;
}
</style>
</head>

<body>
<div class="title">CZ TAKÄ°P</div>
<div class="subtitle">20 gÃ¼nde 1 bÃ¶lÃ¼m Â· 30 bÃ¶lÃ¼mlÃ¼ CZ dÃ¶ngÃ¼sÃ¼</div>

<div class="top">
  <button id="themeBtn" class="chip">ðŸŒ™ Koyu tema</button>
  <button id="startBtn" class="chip">âš™ BaÅŸlangÄ±Ã§ bÃ¶lÃ¼mÃ¼</button>
</div>

<div class="card">
  <h3>ðŸ“… Tarih & SÃ¼re</h3>
  <div class="row"><span class="label">BugÃ¼n:</span><strong id="today"></strong></div>
  <div class="row"><span class="label">BitiÅŸ tarihi:</span><strong id="end"></strong></div>
  <div class="row"><span class="label">Kalan gÃ¼n:</span><strong id="left"></strong></div>
</div>

<div class="card">
  <h3>ðŸ“˜ BÃ¶lÃ¼m Bilgisi</h3>
  <div class="row"><span class="label">Olman gereken bÃ¶lÃ¼m:</span><strong id="section"></strong></div>
  <div class="row"><span class="label">Sayfa aralÄ±ÄŸÄ±:</span><strong id="range"></strong></div>
</div>

<div class="card">
  <h3>ðŸ“– Okuma GiriÅŸi</h3>
  <input id="page" type="number" min="1" max="604" placeholder="Son okuduÄŸun sayfa">
  <div id="info" class="info neutral"></div>
  <button class="save" id="save">Kaydet</button>
</div>

<script>
/* === SÄ°STEM SABÄ°TLERÄ° (DEÄžÄ°ÅžMEZ) === */
const DAY = 86400000;
const REF = Date.UTC(2022,3,12); // Ortak sistem baÅŸlangÄ±cÄ±
const TOTAL = 30;
const PER = 20;
const LAST = 604;
const VERSION = 60;

const $ = id => document.getElementById(id);

/* === GÃœVENLÄ° STATE YÃ–NETÄ°MÄ° === */
function loadState(){
  try{
    const raw = localStorage.getItem("cz_state");
    if(!raw) throw "empty";
    const s = JSON.parse(raw);
    if(s.version !== VERSION) throw "version";
    return s;
  }catch{
    const fresh = {
      version: VERSION,
      start: 1,
      last: 0
    };
    localStorage.setItem("cz_state", JSON.stringify(fresh));
    return fresh;
  }
}

function saveState(s){
  localStorage.setItem("cz_state", JSON.stringify(s));
}

/* === TARÄ°H FONKSÄ°YONLARI === */
function todayUTC(){
  const d = new Date();
  return Date.UTC(d.getFullYear(), d.getMonth(), d.getDate());
}

function fmt(u){
  const d = new Date(u);
  return String(d.getUTCDate()).padStart(2,"0")+"."+
         String(d.getUTCMonth()+1).padStart(2,"0")+"."+
         d.getUTCFullYear();
}

/* === ANA RENDER === */
function render(){
  const s = loadState();
  const now = todayUTC();

  let diff = Math.floor((now - REF) / DAY);
  if(diff < 0) diff = 0;

  const cycle = Math.floor(diff / PER);
  const cycleEnd = REF + cycle*PER*DAY + (PER-1)*DAY;

  $("today").textContent = fmt(now);
  $("end").textContent = fmt(cycleEnd);
  $("left").textContent =
    Math.max(0, Math.floor((cycleEnd-now)/DAY)+1) + " gÃ¼n";

  const reqSection = ((s.start - 1 + cycle) % TOTAL) + 1;
  const dayIn = diff % PER;

  let reqPage = (reqSection - 1) * PER + dayIn + 1;
  if(reqPage > LAST) reqPage = LAST;

  $("section").textContent = reqSection;
  $("range").textContent =
    reqSection === 30 ? "581 â€“ 604"
    : ((reqSection-1)*20+1) + " â€“ " + ((reqSection-1)*20+20);

  const info = $("info");
  if(s.last){
    const d = s.last - reqPage;
    info.style.display = "block";
    if(d > 0){
      info.className = "info ok";
      info.textContent = d + " sayfa ileridesin";
    }else if(d < 0){
      info.className = "info bad";
      info.textContent = Math.abs(d) + " sayfa geridesin";
    }else{
      info.className = "info neutral";
      info.textContent = "Tam yerindesin";
    }
  }else{
    info.style.display = "none";
  }

  $("page").value = s.last || "";
}

/* === EVENTLER === */
$("save").onclick = () => {
  const s = loadState();
  let v = parseInt($("page").value, 10);
  if(Number.isNaN(v) || v <= 0) return;
  if(v > LAST) v = LAST;
  s.last = v;
  saveState(s);
  render();
};

$("startBtn").onclick = () => {
  const s = loadState();
  let n = parseInt(prompt("BaÅŸlangÄ±Ã§ bÃ¶lÃ¼mÃ¼ (1â€“30):", s.start), 10);
  if(n >= 1 && n <= 30){
    s.start = n;
    saveState(s);
    render();
  }
};

$("themeBtn").onclick = () => {
  const dark = document.body.classList.toggle("dark");
  document.body.classList.toggle("light", !dark);
  localStorage.setItem("theme", dark ? "dark" : "light");
};

/* === INIT === */
(function init(){
  const t = localStorage.getItem("theme") || "light";
  document.body.classList.add(t);
  render();
})();
</script>
</body>
</html>
