<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>CZ TAKƒ∞P</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    *{box-sizing:border-box;margin:0;padding:0}

    :root{
      --radius-card:18px;
      --radius-pill:999px;
      --shadow:0 10px 30px rgba(15,23,42,.15);
    }

    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      padding:16px;
      transition:.2s;
    }

    body.light{
      --bg:#eef4ff;
      --card:#fff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#2563eb;
      --soft:#e5edff;
      background:var(--bg);
      color:var(--text);
    }

    body.dark{
      --bg:#020617;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#8b5cf6;
      --soft:#1e293b;
      background:radial-gradient(circle at top,#1e293b,#020617);
      color:var(--text);
    }

    .title{
      text-align:center;
      font-size:32px;
      font-weight:800;
      letter-spacing:.12em;
    }

    .subtitle{
      text-align:center;
      font-size:13px;
      color:var(--muted);
      margin-bottom:16px;
    }

    .top{
      display:flex;
      justify-content:space-between;
      gap:8px;
      margin-bottom:14px;
    }

    .chip{
      border-radius:var(--radius-pill);
      padding:8px 14px;
      border:none;
      background:var(--soft);
      color:var(--accent);
      font-weight:700;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
      white-space:nowrap;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius-card);
      padding:14px 16px;
      margin-bottom:12px;
      box-shadow:var(--shadow);
    }

    .card h3{
      font-size:18px;
      margin-bottom:8px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      margin-top:4px;
      gap:12px;
    }

    .label{color:var(--muted)}
    .value{font-weight:800}

    input{
      width:100%;
      padding:12px;
      border-radius:var(--radius-pill);
      border:1px solid #cbd5f5;
      font-size:18px;
      text-align:center;
      margin-top:6px;
      background:transparent;
      color:inherit;
    }

    .info{
      margin-top:8px;
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      display:none;
    }

    .ok{background:#e8ffe8;color:#16a34a}
    .bad{background:#ffe8e8;color:#dc2626}
    .neutral{background:#e8f0ff;color:#2563eb}

    .save{
      width:100%;
      margin-top:12px;
      padding:14px;
      border-radius:var(--radius-pill);
      border:none;
      font-size:18px;
      font-weight:900;
      background:linear-gradient(90deg,#2563eb,#1d4ed8);
      color:#fff;
      cursor:pointer;
    }

    body.dark .save{
      background:linear-gradient(90deg,#8b5cf6,#6d28d9);
    }

    .note{
      margin-top:10px;
      font-size:12px;
      color:var(--muted);
      line-height:1.35;
    }
  </style>
</head>

<body>
  <div class="title">CZ TAKƒ∞P</div>
  <div class="subtitle">20 g√ºnde 1 b√∂l√ºm ¬∑ 30 b√∂l√ºml√º CZ d√∂ng√ºs√º</div>

  <div class="top">
    <button id="themeBtn" class="chip">üåô Tema</button>
    <button id="setNowBtn" class="chip">‚öôÔ∏è ≈ûu anki b√∂l√ºm</button>
  </div>

  <div class="card">
    <h3>üìÖ Tarih & S√ºre</h3>
    <div class="row"><span class="label">Bug√ºn:</span><span class="value" id="today"></span></div>
    <div class="row"><span class="label">Biti≈ü tarihi:</span><span class="value" id="end"></span></div>
    <div class="row"><span class="label">Kalan g√ºn:</span><span class="value" id="left"></span></div>
  </div>

  <div class="card">
    <h3>üìò B√∂l√ºm Bilgisi</h3>
    <div class="row"><span class="label">Olman gereken b√∂l√ºm:</span><span class="value" id="section"></span></div>
    <div class="row"><span class="label">Sayfa aralƒ±ƒüƒ±:</span><span class="value" id="range"></span></div>
  </div>

  <div class="card">
    <h3>üìñ Okuma Giri≈üi</h3>
    <input id="page" type="number" min="1" max="604" placeholder="Son okuduƒüun sayfa">
    <div id="info" class="info neutral"></div>
    <button class="save" id="save">Kaydet</button>

    <div class="note" id="note">
      Not: Sisteme ilk kez ge√ßerken ‚Äú≈ûu anki b√∂l√ºm‚Äù biliniyorsa onu gir.
      Eƒüer sadece ‚Äú≈ûu anki b√∂l√ºm√ºn‚Äù var ama ilk ba≈üladƒ±ƒüƒ±n b√∂l√ºm√º hatƒ±rlamƒ±yorsan, ekip i√ßi WhatsApp notuna bak.
    </div>
  </div>

  <script>
    const DAY = 86400000;

    const REF  = Date.UTC(2022,3,12); // referans ba≈ülangƒ±√ß (deƒüi≈ütirme)
    const TOTAL = 30;
    const PER = 20;
    const LAST = 604;

    const $ = (id) => document.getElementById(id);

    function todayUTC(){
      const d = new Date();
      return Date.UTC(d.getFullYear(), d.getMonth(), d.getDate());
    }

    function fmt(u){
      const d = new Date(u);
      const dd = String(d.getUTCDate()).padStart(2,"0");
      const mm = String(d.getUTCMonth()+1).padStart(2,"0");
      const yy = d.getUTCFullYear();
      return dd + "." + mm + "." + yy;
    }

    function clampSection(n){
      const v = parseInt(n,10);
      if(!Number.isFinite(v)) return null;
      if(v < 1 || v > TOTAL) return null;
      return v;
    }

    function computeBase(nowUTC){
      let diff = Math.floor((nowUTC - REF)/DAY);
      if(diff < 0) diff = 0;

      const cycle = Math.floor(diff / 20);
      const dayIn = diff % 20;

      const baseSection = (cycle % TOTAL) + 1;  // 1..30
      const baseDayIn = dayIn;                 // 0..19

      const cycleEnd = REF + cycle*20*DAY + 19*DAY;

      return { diff, cycle, dayIn: baseDayIn, baseSection, cycleEnd };
    }

    function getDelta(){
      const raw = localStorage.getItem("delta");
      const v = parseInt(raw,10);
      if(!Number.isFinite(v)) return null;
      if(v < 0 || v >= TOTAL) return null;
      return v;
    }

    function requireSetupIfMissing(){
      const d = getDelta();
      if(d === null){
        askCurrentSection(true);
      }
    }

    function askCurrentSection(isMandatory){
      const now = todayUTC();
      const base = computeBase(now).baseSection;

      const msg =
        "≈ûu anki b√∂l√ºm√ºn (1-30):\n\n" +
        "Not: Bug√ºn sistemin baz b√∂l√ºm√º = " + base + ".\n" +
        "Girdiƒüin b√∂l√ºm, bundan sonraki hesaplamayƒ± sana g√∂re ayarlar.";

      let input = prompt(msg, "");
      if(input === null){
        if(isMandatory){
          alert("Devam etmek i√ßin bir kez '≈ûu anki b√∂l√ºm' girmelisin.");
          return askCurrentSection(true);
        }
        return;
      }

      const userSection = clampSection(input);
      if(userSection === null){
        alert("L√ºtfen 1 ile 30 arasƒ±nda bir sayƒ± gir.");
        return askCurrentSection(isMandatory);
      }

      const delta = (userSection - base + TOTAL) % TOTAL; // DOƒûRU y√∂n
      localStorage.setItem("delta", String(delta));
      render();
    }

    function sectionToRange(section){
      const start = (section - 1) * PER + 1;
      const end = Math.min(section * PER, LAST);
      return start + " ‚Äì " + end;
    }

    function render(){
      const lastPage = parseInt(localStorage.getItem("last") || "0", 10);
      const now = todayUTC();
      const base = computeBase(now);

      $("today").textContent = fmt(now);
      $("end").textContent = fmt(base.cycleEnd);

      const leftDays = Math.max(0, Math.floor((base.cycleEnd - now)/DAY));
      $("left").textContent = leftDays + " g√ºn";

      const delta = getDelta() ?? 0;
      const shownSection = ((base.baseSection + delta - 1) % TOTAL) + 1;

      $("section").textContent = String(shownSection);
      $("range").textContent = sectionToRange(shownSection);

      const dayIn = base.dayIn; // 0..19
      let reqPage = (shownSection - 1) * PER + (dayIn + 1);
      if(reqPage > LAST) reqPage = LAST;

      const info = $("info");
      if(lastPage > 0){
        const diffp = lastPage - reqPage;
        info.style.display = "block";
        if(diffp > 0){
          info.className = "info ok";
          info.textContent = diffp + " sayfa ileridesin";
        }else if(diffp < 0){
          info.className = "info bad";
          info.textContent = Math.abs(diffp) + " sayfa geridesin";
        }else{
          info.className = "info neutral";
          info.textContent = "Tam yerindesin";
        }
      }else{
        info.style.display = "none";
      }

      $("page").value = (lastPage > 0 ? String(lastPage) : "");
    }

    $("save").onclick = () => {
      const v = parseInt($("page").value || "0", 10);
      if(v > 0 && v <= LAST){
        localStorage.setItem("last", String(v));
      }
      render();
    };

    $("themeBtn").onclick = () => {
      const dark = document.body.classList.toggle("dark");
      document.body.classList.toggle("light", !dark);
      localStorage.setItem("theme", dark ? "dark" : "light");
    };

    $("setNowBtn").onclick = () => askCurrentSection(false);

    (function init(){
      const t = localStorage.getItem("theme") || "light";
      document.body.classList.add(t);

      requireSetupIfMissing();
      render();
    })();
  </script>
</body>
</html>
