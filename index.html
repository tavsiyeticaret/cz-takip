<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>CZ TAKÄ°P</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    :root{
      --radius-card:18px;
      --radius-pill:999px;
      --shadow:0 10px 30px rgba(15,23,42,.15);
    }
    body{
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif;
      padding:16px;
      transition:.2s;
    }

    body.light{
      --bg:#eef4ff;
      --card:#fff;
      --text:#111827;
      --muted:#6b7280;
      --accent:#2563eb;
      --soft:#e5edff;
      background:var(--bg);
      color:var(--text);
    }

    body.dark{
      --bg:#020617;
      --card:#0f172a;
      --text:#e5e7eb;
      --muted:#9ca3af;
      --accent:#8b5cf6;
      --soft:#1e293b;
      background:radial-gradient(circle at top,#1e293b,#020617);
      color:var(--text);
    }

    .title{
      text-align:center;
      font-size:32px;
      font-weight:800;
      letter-spacing:.12em;
      margin-top:2px;
    }
    .subtitle{
      text-align:center;
      font-size:13px;
      color:var(--muted);
      margin:6px 0 14px;
    }

    .top{
      display:flex;
      justify-content:space-between;
      gap:8px;
      margin-bottom:14px;
    }

    .chip{
      border-radius:var(--radius-pill);
      padding:10px 14px;
      border:none;
      background:var(--soft);
      color:var(--accent);
      font-weight:700;
      cursor:pointer;
      display:flex;
      align-items:center;
      gap:8px;
    }

    .card{
      background:var(--card);
      border-radius:var(--radius-card);
      padding:14px 16px;
      margin-bottom:12px;
      box-shadow:var(--shadow);
    }
    .card h3{
      font-size:18px;
      margin-bottom:8px;
    }

    .row{
      display:flex;
      justify-content:space-between;
      margin-top:4px;
      gap:12px;
    }
    .label{color:var(--muted)}

    input{
      width:100%;
      padding:12px;
      border-radius:var(--radius-pill);
      border:1px solid #cbd5f5;
      font-size:18px;
      text-align:center;
      margin-top:6px;
      background:transparent;
      color:inherit;
    }

    .info{
      margin-top:10px;
      padding:10px 12px;
      border-radius:12px;
      font-weight:800;
      display:none;
    }
    .ok{background:#e8ffe8;color:#16a34a}
    .bad{background:#ffe8e8;color:#dc2626}
    .neutral{background:#e8f0ff;color:#2563eb}

    .save{
      width:100%;
      margin-top:12px;
      padding:14px;
      border-radius:var(--radius-pill);
      border:none;
      font-size:18px;
      font-weight:800;
      background:linear-gradient(90deg,#2563eb,#1d4ed8);
      color:#fff;
      cursor:pointer;
    }

    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:8px;
      line-height:1.35;
    }
  </style>
</head>

<body>
  <div class="title">CZ TAKÄ°P</div>
  <div class="subtitle">20 gÃ¼nde 1 bÃ¶lÃ¼m Â· 30 bÃ¶lÃ¼mlÃ¼ CZ dÃ¶ngÃ¼sÃ¼</div>

  <div class="top">
    <button id="themeBtn" class="chip">ğŸŒ™ Tema</button>
    <button id="curBtn" class="chip">âš™ï¸ Åu anki bÃ¶lÃ¼m</button>
  </div>

  <div class="card">
    <h3>ğŸ“… Tarih & SÃ¼re</h3>
    <div class="row"><span class="label">BugÃ¼n:</span><strong id="today"></strong></div>
    <div class="row"><span class="label">BitiÅŸ tarihi:</span><strong id="end"></strong></div>
    <div class="row"><span class="label">Kalan gÃ¼n:</span><strong id="left"></strong></div>
  </div>

  <div class="card">
    <h3>ğŸ“˜ BÃ¶lÃ¼m Bilgisi</h3>
    <div class="row"><span class="label">Olman gereken bÃ¶lÃ¼m:</span><strong id="section"></strong></div>
    <div class="row"><span class="label">Sayfa aralÄ±ÄŸÄ±:</span><strong id="range"></strong></div>
  </div>

  <div class="card">
    <h3>ğŸ“– Okuma GiriÅŸi</h3>
    <input id="page" type="number" min="1" max="604" placeholder="Son okuduÄŸun sayfa" />
    <div id="info" class="info neutral"></div>
    <button class="save" id="save">Kaydet</button>
    <div class="hint">
      Not: Bu sisteme geÃ§erken herkes 3 yÄ±l Ã¶nceki ilk bÃ¶lÃ¼mÃ¼nÃ¼ hatÄ±rlamayabilir.
      Ä°lk aÃ§Ä±lÄ±ÅŸta sadece â€œÅu anki bÃ¶lÃ¼mâ€Ã¼nÃ¼ gir. Sistem otomatik olarak â€œbaÅŸlangÄ±Ã§ bÃ¶lÃ¼mÃ¼nÃ¼â€ (ÅŸu anki bÃ¶lÃ¼m âˆ’ 7) ÅŸeklinde hesaplar.
      Sonradan saÄŸ Ã¼stten tekrar deÄŸiÅŸtirilebilir.
    </div>
  </div>

  <script>
    const DAY = 86400000;

    const REF = Date.UTC(2026, 0, 1);     // 01.01.2026 UTC
    const TOTAL = 30;                    // 30 bÃ¶lÃ¼m
    const DAYS_PER_SECTION = 20;         // 20 gÃ¼n
    const PAGES_PER_SECTION = 20;        // 20 sayfa
    const LAST_PAGE = 604;

    const $ = (id) => document.getElementById(id);

    function todayUTCStart(){
      const d = new Date();
      return Date.UTC(d.getFullYear(), d.getMonth(), d.getDate());
    }

    function fmtUTC(u){
      const d = new Date(u);
      const dd = String(d.getUTCDate()).padStart(2,"0");
      const mm = String(d.getUTCMonth()+1).padStart(2,"0");
      const yy = d.getUTCFullYear();
      return dd + "." + mm + "." + yy;
    }

    function wrapSection(n){
      let x = n % TOTAL;
      if(x <= 0) x += TOTAL;
      return x;
    }

    function askCurrentSection(force){
      const already = localStorage.getItem("startSection");
      if(already && !force) return;

      let cur = prompt(
        "Åu an hangi bÃ¶lÃ¼mdesin? (1â€“30)\n\nSistem otomatik hesaplar:\nBaÅŸlangÄ±Ã§ = (Åu anki bÃ¶lÃ¼m âˆ’ 7)\nÃ–rnek: 8 â†’ 1, 5 â†’ 28"
      );

      if(cur === null) return;

      cur = parseInt(cur,10);
      if(!Number.isFinite(cur) || cur < 1 || cur > 30){
        alert("LÃ¼tfen 1 ile 30 arasÄ±nda bir bÃ¶lÃ¼m gir.");
        return askCurrentSection(true);
      }

      const start = wrapSection(cur - 7);
      localStorage.setItem("startSection", String(start));
    }

    function getStartSection(){
      const v = parseInt(localStorage.getItem("startSection") || "0", 10);
      if(Number.isFinite(v) && v >= 1 && v <= 30) return v;
      return 0;
    }

    function render(){
      const now = todayUTCStart();
      let diffDays = Math.floor((now - REF) / DAY);
      if(diffDays < 0) diffDays = 0;

      const cycle = Math.floor(diffDays / DAYS_PER_SECTION);             // kaÃ§Ä±ncÄ± 20 gÃ¼nlÃ¼k blok
      const cycleStart = REF + cycle * DAYS_PER_SECTION * DAY;           // bloÄŸun baÅŸlangÄ±cÄ±
      const cycleEnd = cycleStart + (DAYS_PER_SECTION - 1) * DAY;        // bloÄŸun bitiÅŸ gÃ¼nÃ¼ (gÃ¶rÃ¼nen tarih)

      $("today").textContent = fmtUTC(now);
      $("end").textContent = fmtUTC(cycleEnd);

      const left = Math.max(0, Math.floor((cycleEnd - now) / DAY));      // bugÃ¼nÃ¼ saymadan
      $("left").textContent = left + " gÃ¼n";

      const startSection = getStartSection();
      const base = startSection ? (startSection - 1) : 0;

      const requiredSection = ((base + cycle) % TOTAL) + 1;              // kiÅŸiye gÃ¶re bÃ¶lÃ¼m
      const dayIn = diffDays % DAYS_PER_SECTION;

      let reqPage = (requiredSection - 1) * PAGES_PER_SECTION + dayIn + 1;
      if(reqPage > LAST_PAGE) reqPage = LAST_PAGE;

      $("section").textContent = requiredSection;

      const startPage = (requiredSection - 1) * PAGES_PER_SECTION + 1;
      let endPage = (requiredSection - 1) * PAGES_PER_SECTION + PAGES_PER_SECTION;
      if(endPage > LAST_PAGE) endPage = LAST_PAGE;
      $("range").textContent = startPage + " â€“ " + endPage;

      const last = parseInt(localStorage.getItem("lastPage") || "0", 10);
      const info = $("info");

      if(last && Number.isFinite(last)){
        const d = last - reqPage;
        info.style.display = "block";
        if(d > 0){
          info.className = "info ok";
          info.textContent = d + " sayfa ileridesin";
        }else if(d < 0){
          info.className = "info bad";
          info.textContent = Math.abs(d) + " sayfa geridesin";
        }else{
          info.className = "info neutral";
          info.textContent = "Tam yerindesin";
        }
      }else{
        info.style.display = "none";
      }

      $("page").value = last ? String(last) : "";
    }

    $("save").onclick = () => {
      let v = parseInt($("page").value || "0", 10);
      if(Number.isFinite(v) && v >= 1 && v <= LAST_PAGE){
        localStorage.setItem("lastPage", String(v));
      }
      render();
    };

    $("themeBtn").onclick = () => {
      const isDark = document.body.classList.toggle("dark");
      document.body.classList.toggle("light", !isDark);
      localStorage.setItem("theme", isDark ? "dark" : "light");
    };

    $("curBtn").onclick = () => {
      askCurrentSection(true);
      render();
    };

    (function init(){
      const t = localStorage.getItem("theme") || "light";
      document.body.classList.add(t);

      if(!getStartSection()){
        askCurrentSection(true);  // ZORUNLU ilk aÃ§Ä±lÄ±ÅŸ
      }

      render();
    })();
  </script>
</body>
</html>
